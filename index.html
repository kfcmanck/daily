<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM ë¡œë“œ í›„ ì‹¤í–‰ë˜ëŠ” ì´ëª¨ì§€ ë¨¼ìŠ¬ë¦¬ ë‹¤ì´ì–´ë¦¬</title>
    <style>
        /* ì´ì „ CSS ìŠ¤íƒ€ì¼ì„ ê·¸ëŒ€ë¡œ ìœ ì§€ */
    </style>
</head>
<body>
    <div class="container">
        <div id="calendar">
            <h1>ğŸ“… ì´ëª¨ì§€ ë¨¼ìŠ¬ë¦¬ ë‹¤ì´ì–´ë¦¬</h1>
            <div class="month-header">
                <button id="prevMonth">â—€</button>
                <span id="currentMonthYear"></span>
                <button id="nextMonth">â–¶</button>
            </div>
            <div class="weekdays">
                <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
            </div>
            <div class="days"></div>
        </div>
        <div class="sidebar">
            <form id="eventForm">
                <input type="text" id="eventTitle" placeholder="ì¼ì • ì œëª©" required>
                <input type="date" id="eventDate" required>
                <input type="time" id="eventTime" required>
                <button type="submit">â• ì¼ì • ì¶”ê°€</button>
            </form>
            <div id="eventDetails">
                <h2 id="detailTitle"></h2>
                <p id="detailDateTime"></p>
                <button id="deleteEvent">ğŸ—‘ï¸ ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendar = document.getElementById('calendar');
            const eventForm = document.getElementById('eventForm');
            const eventDetails = document.getElementById('eventDetails');
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');
            const currentMonthYearElement = document.getElementById('currentMonthYear');

            const eventIcons = {
                "íšŒì˜": "ğŸ’¼", "ìƒì¼": "ğŸ‚", "ì—¬í–‰": "âœˆï¸", "ê³µë¶€": "ğŸ“š",
                "ìš´ë™": "ğŸ‹ï¸", "ì•½ì†": "ğŸ¤", "ê¸°ë…ì¼": "ğŸ‰", "default": "ğŸ“Œ"
            };

            const monthNames = ["1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”", "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"];

            let currentDate = new Date();
            let events = [];
            let selectedEventIndex = -1;

            function getEventIcon(title) {
                return eventIcons[Object.keys(eventIcons).find(key => title.includes(key))] || eventIcons.default;
            }

            function loadEventsFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const eventsParam = urlParams.get('events');
                if (eventsParam) {
                    events = JSON.parse(decodeURIComponent(eventsParam));
                }
            }

            function saveEventsToURL() {
                const eventsParam = encodeURIComponent(JSON.stringify(events));
                const newURL = `${window.location.pathname}?events=${eventsParam}`;
                window.history.pushState({path: newURL}, '', newURL);
            }

            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);

                currentMonthYearElement.textContent = `${year}ë…„ ${monthNames[month]}`;

                const daysContainer = calendar.querySelector('.days');
                daysContainer.innerHTML = '';

                const fragment = document.createDocumentFragment();

                for (let i = 0; i < firstDay.getDay(); i++) {
                    fragment.appendChild(document.createElement('div'));
                }

                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'day';
                    dayElement.textContent = i;

                    const dayEvents = events.filter(event => {
                        const eventDate = new Date(event.dateTime);
                        return eventDate.getDate() === i && eventDate.getMonth() === month && eventDate.getFullYear() === year;
                    });

                    dayEvents.forEach(event => {
                        const eventElement = document.createElement('div');
                        eventElement.className = 'event';
                        const icon = getEventIcon(event.title);
                        eventElement.innerHTML = `<span class="event-icon">${icon}</span>${event.title}`;
                        eventElement.style.backgroundColor = getRandomColor(event.title);
                        eventElement.style.color = 'white';
                        eventElement.onclick = () => showEventDetails(event);
                        dayElement.appendChild(eventElement);
                    });

                    fragment.appendChild(dayElement);
                }

                daysContainer.appendChild(fragment);
            }

            function getRandomColor(seed) {
                let hash = 0;
                for (let i = 0; i < seed.length; i++) {
                    hash = seed.charCodeAt(i) + ((hash << 5) - hash);
                }
                const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
                return "#" + "00000".substring(0, 6 - c.length) + c;
            }

            function addEvent(title, dateTime) {
                events.push({ title, dateTime });
                saveEventsToURL();
                renderCalendar();
                scheduleNotification(title, new Date(dateTime));
            }

            function deleteEvent(index) {
                events.splice(index, 1);
                saveEventsToURL();
                renderCalendar();
                hideEventDetails();
            }

            function showEventDetails(event) {
                selectedEventIndex = events.findIndex(e => e.title === event.title && e.dateTime === event.dateTime);
                document.getElementById('detailTitle').textContent = event.title;
                document.getElementById('detailDateTime').textContent = new Date(event.dateTime).toLocaleString();
                eventDetails.style.display = 'block';
            }

            function hideEventDetails() {
                eventDetails.style.display = 'none';
                selectedEventIndex = -1;
            }

            function scheduleNotification(title, dateTime) {
                const now = new Date();
                const timeDiff = dateTime.getTime() - now.getTime();

                if (timeDiff > 0) {
                    setTimeout(() => {
                        if (Notification.permission === "granted") {
                            new Notification(title, {
                                body: "ì¼ì • ì•Œë¦¼ì…ë‹ˆë‹¤!",
                                icon: "https://github.com/favicon.ico"
                            });
                        } else if (Notification.permission !== "denied") {
                            Notification.requestPermission().then(permission => {
                                if (permission === "granted") {
                                    new Notification(title, {
                                        body: "ì¼ì • ì•Œë¦¼ì…ë‹ˆë‹¤!",
                                        icon: "https://github.com/favicon.ico"
                                    });
                                }
                            });
                        }
                    }, timeDiff);
                }
            }

            eventForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const title = document.getElementById('eventTitle').value;
                const date = document.getElementById('eventDate').value;
                const time = document.getElementById('eventTime').value;
                const dateTime = new Date(date + 'T' + time).toISOString();
                addEvent(title, dateTime);
                eventForm.reset();
            });

            document.getElementById('deleteEvent').addEventListener('click', function() {
                if (selectedEventIndex !== -1) {
                    deleteEvent(selectedEventIndex);
                }
            });

            prevMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            if (Notification.permission !== "granted" && Notification.permission !== "denied") {
                Notification.requestPermission();
            }

            loadEventsFromURL();
            renderCalendar();

            events.forEach(event => {
                scheduleNotification(event.title, new Date(event.dateTime));
            });
        });
    </script>
</body>
</html>
